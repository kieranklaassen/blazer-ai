<a id="generate-sql"
   class="btn btn-success"
   href="javascript:void(0);">
  Generate SQL (LLM)
</a>

<script>
  document.getElementById('generate-sql').addEventListener('click', generateSql);
  
  function generateSql(event) {
    event.preventDefault();

    // Get form values - query name and description
    const name = document.querySelector('input[name="query[name]"]').value;
    const description = document.querySelector('textarea[name="query[description]"]').value;
    
    // Get the URL from our module
    const generateSqlUrl = <%= raw Blazer::Ai.configuration.generate_sql_path.to_json %>;

    // AJAX request to generate SQL
    fetch(generateSqlUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
      },
      body: JSON.stringify({
        query: {
          name: name,
          description: description
        }
      })
    })
    .then(response => response.json())
    .then(data => {
      if (data.sql) {
        if (window.editor) {
          editor.setValue(data.sql, 1);
        } else {
          document.querySelector('textarea[name="query[statement]"]').value = data.sql;
        }
      } else {
        alert(data.error || "Generation failed");
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert("Error generating SQL. Please try again.");
    });
  }
</script>